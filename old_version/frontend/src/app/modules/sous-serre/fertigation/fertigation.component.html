<div class="container-fluid">
  <app-page-title title="Fertigation" [breadcrumbItems]="breadCrumbItems"></app-page-title>
  <div class="row">
    <div class="row">
      <div class="col-lg-3">
        <div class="row">
          <div class="col-lg-12">
            <div class="card mini-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">

                  <div class="mr-3 mt-2">
                    <select class="form-select" style="width: 180px" aria-label="Default select example" (change)="onGreenhouseChange($event.target.value)">
                      <option>Choisir une serre</option>
                      <option *ngFor="let greenhouse of greenhouses" [value]="greenhouse.id">{{greenhouse.name}}</option>
                    </select>
                  </div>

                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-list-alt"></i>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-12">
            <div class="card pt-5 pb-3">
              <div class="card-title text-center p-3">
                <h4>{{selectedGreenhouse?.name}}
                  <span *ngIf="this.selectedGreenhouse && this.manualIrrigationSwitch" class="badge text-white fs-5" style="background-color: #034035">ON</span>
                  <span *ngIf="this.selectedGreenhouse && !this.manualIrrigationSwitch" class="badge text-white fs-5" style="background-color: #8f2c2c">OFF</span>
                </h4>
                <img class="mt-2" ngSrc="assets/images/greenhouse.jpg" width="200" height="153">
              </div>
              <div class="card-body p-3 pt-3">
                <ul>
                  <li>
                    <p class="fw-bold">Dimensions :</p>
                    <ul>
                      <li>
                        <p class="fw-bold">Length : <span class="fw-normal">{{selectedGreenhouse?.length}} M</span></p>
                      </li>
                      <li>
                        <p class="fw-bold">Width : <span class="fw-normal">{{selectedGreenhouse?.width}} M</span></p>
                      </li>
                      <li>
                        <p class="fw-bold">Height : <span class="fw-normal">{{selectedGreenhouse?.height}} M</span></p>
                      </li>
                    </ul>
                  </li>
                </ul>
                <div class="row pt-5">
                  <div class="col-lg-6 d-flex justify-content-center align-items-center">
                      <button *ngIf="this.selectedGreenhouse" type="button" (click)="openModal(modalIrrigation)" class="btn" style="background-color: #6da8fa; color: white">
                        <i class="fas fa-water"></i>
                      </button>
                    <button *ngIf="this.selectedGreenhouse" type="button" (click)="openModal(modal)" class="btn"
                            style="background-color: #034035; color: white; margin-left: 10px">
                      <i class="fas fa-edit"></i>
                    </button>
                  </div>
                  <div class="col-lg-6 d-flex justify-content-center align-items-end">
                      <!-- Button for adding a new greenhouse -->
                      <button type="button" (click)="openAddGreenhouseModal(addGreenhouseModal)" class="btn ms-2" style="background-color: #fb8f4d; color: white">
                        <i class="fas fa-plus"></i> Ajouter
                      </button>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-9">
        <div class="row">
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-muted mb-2">Date & Temps</p>
                    <h5 class="mb-0">{{ currentDateTime }}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-calendar-minus"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card mini-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-muted mb-2">Saison</p>
                    <h5 class="mb-0">{{this.greenhouseDetails?.saison}}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-cloud-sun"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-muted mb-2">Prévisions météorologiques</p>
                    <h5 class="mb-0">{{this.greenhouseDetails?.previsions_meteorologiques}}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-cloud-moon"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-muted mb-2">Systeme d'irrigation</p>
                    <h5 class="mb-0">{{this.greenhouseDetails?.systeme_d_irrigation}}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-faucet"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">
                  <div class="me-3">
                    <p class="text-muted mb-2">Stage de croissance</p>
                    <h5 class="mb-0">{{this.greenhouseDetails?.stage_de_croissance}}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-leaf"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-muted mb-2">Type de varieté</p>
                    <h5 class="mb-0">{{this.greenhouseDetails?.type_de_variete}}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20"
                         style="background-color: #054237">
                      <i class="fas fa-bars"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="card mini-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2 ">Temperature de l'air</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.temperature_de_l_air}} °C </h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <i class="fas fa-thermometer-half" style="color: #054237;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="me-3">
                    <p class="text-white mb-2">Humidité relative</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.humidite_relative}} %</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <i class="fas fa-tint" style="color: #054237;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2">Radiation solaire</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.radiation_solaire}} W/m²</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <i class="fas fa-sun" style="color: #054237;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2">CO2 Atmosphérique</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.co2_atmospherique}} ppm</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <span class="fs-5" style="color: #054237;"> CO₂</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card mini-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2 ">Temperature du sol</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.temperature_du_sol}} °C</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <i class="fas fa-thermometer-half" style="color: #054237;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="me-3">
                    <p class="text-white mb-2">Humidité du sol</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.humidite_du_sol}} %</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <i class="fas fa-tint" style="color: #054237;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2">Conductivité_électrique</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.conductivite_electrique}} dS/m</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <i class="fas fa-bolt" style="color: #054237;"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2">PH du sol</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.ph_du_sol}}</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <span class="fs-5" style="color: #054237;"> PH</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2">Concentration en N</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.concentration_en_n}} dS/m</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <span class="fs-5" style="color: #054237;"> N</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="mr-3">
                    <p class="text-white mb-2">Concentration en P</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.concentration_en_p}} mg/kg</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <span class="fs-5" style="color: #054237;"> P</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card blog-stats-wid">
              <div class="card-body" style="background-color: #054237;">
                <div class="d-flex flex-wrap">
                  <div class="me-3">
                    <p class="text-white mb-2">Concentration en K</p>
                    <h5 class="text-white mb-0">{{this.greenhouseDetails?.concentration_en_k}} mg/kg</h5>
                  </div>
                  <div class="avatar-sm ms-auto">
                    <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                      <span class="fs-5" style="color: #054237;"> K</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
      <div class="row">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-body">
              <h3 class="card-title text-center">Prédiction du jour</h3>
              <div class="pt-2 row">
                <div class="col-lg-3">
                  <div class="card blog-stats-wid">
                    <div class="card-body" style="background: rgb(251,143,77);
                                                   background: linear-gradient(90deg, rgba(251,143,77,1) -50%, rgba(5,66,55,1) 100%);">
                      <div class="d-flex flex-wrap">
                        <div class="me-3">
                          <p class="text-white mb-2">Quantité d'eau</p>
                          <h5 class="text-white mb-0">{{predictions?.predictions[0][0][0] | number:'1.2-2' }} mL / M2</h5>
                        </div>
                        <div class="avatar-sm ms-auto">
                          <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                            <span class="fs-5" style="color: #054237;"> W</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-3">
                  <div class="card blog-stats-wid">
                    <div class="card-body" style="background: rgb(251,143,77);
                                                   background: linear-gradient(90deg, rgba(251,143,77,1) -50%, rgba(5,66,55,1) 100%);">
                      <div class="d-flex flex-wrap">
                        <div class="me-3">
                          <p class="text-white mb-2">Nutriment N</p>
                          <h5 class="text-white mb-0">{{predictions?.predictions[0][0][1] | number:'1.2-2'}} ppm</h5>
                        </div>
                        <div class="avatar-sm ms-auto">
                          <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                            <span class="fs-5" style="color: #054237;"> N</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-3">
                  <div class="card blog-stats-wid">
                    <div class="card-body" style="background: rgb(251,143,77);
                                                   background: linear-gradient(90deg, rgba(251,143,77,1) -50%, rgba(5,66,55,1) 100%);">
                      <div class="d-flex flex-wrap">
                        <div class="me-3">
                          <p class="text-white mb-2">Nutriment P</p>
                          <h5 class="text-white mb-0">{{predictions?.predictions[0][0][2] | number:'1.2-2' }} ppm</h5>
                        </div>
                        <div class="avatar-sm ms-auto">
                          <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                            <span class="fs-5" style="color: #054237;"> P</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-3">
                  <div class="card blog-stats-wid">
                    <div class="card-body" style="background: rgb(251,143,77);
                                                   background: linear-gradient(90deg, rgba(251,143,77,1) -50%, rgba(5,66,55,1) 100%);">
                      <div class="d-flex flex-wrap">
                        <div class="me-3">
                          <p class="text-white mb-2">Nutriment K</p>
                          <h5 class="text-white mb-0">{{predictions?.predictions[0][0][3] | number:'1.2-2'}} ppm</h5>
                        </div>
                        <div class="avatar-sm ms-auto">
                          <div class="avatar-title rounded-circle text-white font-size-20" style="background-color: #FFF">
                            <span class="fs-5" style="color: #054237;"> K</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-12">
                  <div class="card">
                    <div class="card-body">
                      <h3 class="card-title text-center">Prédictions des 8 Jours Prochaine</h3>
                      <div style=" height: 500px; width: 100%">
                        <canvas baseChart
                                [data]="lineChartData"
                                [options]="lineChartOptions"
                                [type]="lineChartType">
                        </canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>




  </div>

  <ng-template #modal role="document" let-modal>
    <div class="modal-header">
      <h5 class="modal-title text-center" id="myModalLabel">Modifie la serre</h5>
    </div>
    <div class="row p-5">
      <div class="col-lg-12 text-center">
        <h3>Greenhouse </h3>
        <img class="mt-2" ngSrc="assets/images/greenhouse.jpg" width="200" height="153">
      </div>
      <div class="col-lg-12">
        <div class="mr-3 mt-2">
          <p class="text-muted mb-2">Systéme d'irrigation</p>
          <label class="col-form-label">Systéme d'irrigation :</label>
          <select class="form-select" [(ngModel)]="irrigationSystem">
            <option value="Goutte à goutte">Goutte à goutte</option>
            <option value="Par Aspersion">Par Aspersion</option>
          </select>
        </div>
      </div>
      <div class="col-lg-12">
        <div class="mr-3 mt-2">
          <label class="col-form-label">Type de Varieté :</label>
          <select class="form-select" [(ngModel)]="varietyType">
            <option value="Tomate_Cerise">Tomate Cerise</option>
            <option value="Aubergine">Aubergine</option>
            <option value="Concombre">Concombre</option>
            <option value="Courgette">Courgette</option>
            <option value="Poivron">Poivron</option>
          </select>
        </div>
      </div>
      <div class="col-lg-12">
        <div class="mr-3 mt-2">
          <p class="text-muted mb-2">Stage de croissance</p>
          <input class="form-control" type="text" placeholder="Stage de croissance" [(ngModel)]="growthStage"/>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn  waves-effect text-white" style="background-color: #fb8f4d "
              data-bs-dismiss="modal" (click)="modalRef.hide()">
        Close
      </button>
      <button type="button" class="btn  waves-effect text-white" style="background-color: #034035" (click)="saveChanges()">Save
        changes
      </button>
    </div>
  </ng-template>

  <ng-template #addGreenhouseModal role="document" let-modal>
    <div class="modal-header">
      <h5 class="modal-title text-center" id="myModalLabel">Ajouter une nouvelle serre</h5>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="col-lg-12">
          <div class="mr-3 mt-2">
            <label class="col-form-label">Nom de la serre :</label>
            <input [(ngModel)]="newGreenhouseName" class="form-control" type="text" placeholder="Nom de la serre" />
          </div>
        </div>
        <div class="col-lg-12">
          <div class="mr-3 mt-2">
            <label class="col-form-label">Longueur :</label>
            <input [(ngModel)]="newGreenhouseLength" class="form-control" type="number" placeholder="Longueur (m)" />
          </div>
        </div>
        <div class="col-lg-12">
          <div class="mr-3 mt-2">
            <label class="col-form-label">Largeur :</label>
            <input [(ngModel)]="newGreenhouseWidth" class="form-control" type="number" placeholder="Largeur (m)" />
          </div>
        </div>
        <div class="col-lg-12">
          <div class="mr-3 mt-2">
            <label class="col-form-label">Hauteur :</label>
            <input [(ngModel)]="newGreenhouseHeight" class="form-control" type="number" placeholder="Hauteur (m)" />
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn waves-effect text-white" style="background-color: #fb8f4d" (click)="modal.hide()">Fermer</button>
      <button type="button" class="btn waves-effect text-white" style="background-color: #034035" (click)="addGreenhouse()">Ajouter</button>
    </div>
  </ng-template>

  <ng-template #modalIrrigation let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Configurer le Processus d'Irrigation</h5>
    </div>
    <div class="modal-body">
      <label for="irrigation-process" class="col-form-label">Processus d'Irrigation :</label>
      <select class="form-select" [(ngModel)]="selectedIrrigationProcess" (change)="updateIrrigationProcess()">
        <option value="IA_Irrigation">IA Irrigation</option>
        <option value="Manual_Irrigation">Manual Irrigation</option>
      </select>
      <div *ngIf="selectedIrrigationProcess === 'Manual_Irrigation'">
        <div class="form-check form-switch pt-2">
          <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault"
                 [checked]="manualIrrigationSwitch" (change)="manualIrrigationSwitchMethode()">
          <label class="form-check-label" for="flexSwitchCheckDefault">
            <div *ngIf="manualIrrigationSwitch">On</div>
            <div *ngIf="!manualIrrigationSwitch">Off</div>
          </label>
        </div>
        <div *ngIf="manualIrrigationSwitch" class="d-flex justify-content-center align-items-center" style="height: 300px">
          <i class="fas fa-tint fa-10x" style="color: #6796bb"></i>
        </div>
        <div *ngIf="!manualIrrigationSwitch" class="d-flex justify-content-center align-items-center" style="height: 300px">
          <i class="fas fa-tint-slash fa-10x" style="color: #6796bb"></i>
        </div>
      </div>
      <div *ngIf="selectedIrrigationProcess === 'IA_Irrigation'">
        <div class="d-flex justify-content-center align-items-center" style="height: 300px">
          <i class="fas fa-tint fa-10x" style="color: #6796bb"></i>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Close</button>
    </div>
  </ng-template>

  <ngx-spinner
    bdColor="rgba(51,51,51,0.8)"
    size="medium"
    color="#fff"
    type="ball-scale-multiple"
    [fullScreen]="true">
  </ngx-spinner>


</div>

